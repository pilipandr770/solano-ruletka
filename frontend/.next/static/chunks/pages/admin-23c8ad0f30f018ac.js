(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[964],{8162:function(e){"use strict";e.exports=function(e){if(e.length>=255)throw TypeError("Alphabet too long");for(var t=new Uint8Array(256),n=0;n<t.length;n++)t[n]=255;for(var r=0;r<e.length;r++){var a=e.charAt(r),i=a.charCodeAt(0);if(255!==t[i])throw TypeError(a+" is ambiguous");t[i]=r}var l=e.length,o=e.charAt(0),s=Math.log(l)/Math.log(256),c=Math.log(256)/Math.log(l);function d(e){if("string"!=typeof e)throw TypeError("Expected String");if(0===e.length)return new Uint8Array;for(var n=0,r=0,a=0;e[n]===o;)r++,n++;for(var i=(e.length-n)*s+1>>>0,c=new Uint8Array(i);e[n];){var d=e.charCodeAt(n);if(d>255)return;var u=t[d];if(255===u)return;for(var h=0,f=i-1;(0!==u||h<a)&&-1!==f;f--,h++)u+=l*c[f]>>>0,c[f]=u%256>>>0,u=u/256>>>0;if(0!==u)throw Error("Non-zero carry");a=h,n++}for(var y=i-a;y!==i&&0===c[y];)y++;for(var m=new Uint8Array(r+(i-y)),w=r;y!==i;)m[w++]=c[y++];return m}return{encode:function(t){if(t instanceof Uint8Array||(ArrayBuffer.isView(t)?t=new Uint8Array(t.buffer,t.byteOffset,t.byteLength):Array.isArray(t)&&(t=Uint8Array.from(t))),!(t instanceof Uint8Array))throw TypeError("Expected Uint8Array");if(0===t.length)return"";for(var n=0,r=0,a=0,i=t.length;a!==i&&0===t[a];)a++,n++;for(var s=(i-a)*c+1>>>0,d=new Uint8Array(s);a!==i;){for(var u=t[a],h=0,f=s-1;(0!==u||h<r)&&-1!==f;f--,h++)u+=256*d[f]>>>0,d[f]=u%l>>>0,u=u/l>>>0;if(0!==u)throw Error("Non-zero carry");r=h,a++}for(var y=s-r;y!==s&&0===d[y];)y++;for(var m=o.repeat(n);y<s;++y)m+=e.charAt(d[y]);return m},decodeUnsafe:d,decode:function(e){var t=d(e);if(t)return t;throw Error("Non-base"+l+" character")}}}},7191:function(e,t,n){let r=n(8162);e.exports=r("123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz")},577:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/admin",function(){return n(4298)}])},4298:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return m}});var r=n(5893),a=n(9008),i=n.n(a),l=n(7294),o=n(9917),s=n(9828),c=n(7191),d=n.n(c),u=n(6092),h=n(3439),f=n(2872),y=n(5208);function m(){let[e,t]=(0,l.useState)(null),[n,a]=(0,l.useState)(0),[c,m]=(0,l.useState)(""),[w,v]=(0,l.useState)(function(e){if(!e)return"";let t=e.split(/[\s,]+/g).map(e=>e.trim()).filter(Boolean)[0];if(!t)return"";try{return new o.PublicKey(t),t}catch(e){return""}}("67aWHV5cwANX6ZkHSdDiW87ksqbzHzukCsSrasxPb3R4")||""),[p,g]=(0,l.useState)(!1),b="https://api.devnet.solana.com",x=(0,l.useMemo)(()=>new o.Connection(b),[b]);function j(){var e;let t=window;return t.solana&&t.solana.isPhantom?t.solana:t.solflare?t.solflare:t.solana?t.solana:(null===(e=t.phantom)||void 0===e?void 0:e.solana)?t.phantom.solana:null}let A=(0,l.useCallback)(async()=>{try{let e;let n=j();if(!n)return alert("No supported Solana wallet found (Phantom / Solflare)");try{e=await n.connect({onlyIfTrusted:!1})}catch(t){e=await n.connect()}let r=(null==e?void 0:e.publicKey)||n.publicKey;r&&t(new o.PublicKey(r.toString()))}catch(e){console.error(e),alert((null==e?void 0:e.message)||e)}},[]),N=(0,l.useCallback)(async()=>{try{var e,n;await (null===(n=window.solana)||void 0===n?void 0:null===(e=n.disconnect)||void 0===e?void 0:e.call(n))}catch(e){}t(null),a(0),g(!1)},[]);async function k(){if(!e)throw Error("Connect wallet first");let t=j();if(!t)throw Error("Wallet not connected");let n=new s.Y7(x,t,{preflightCommitment:"confirmed"}),r="ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt";if(!r)throw Error("NEXT_PUBLIC_PROGRAM_ID is missing");let a=new o.PublicKey(r),{program:i}=await f.ZP.initProgram(y,a,n);return{program:i,provider:n}}(0,l.useEffect)(()=>{(async()=>{try{if(!e){a(0);return}let t="GrSGzfP8B7fpbiE4mAAJRxW3bvvumdAXiBYb84ggt1Jk";if(!t){a(0);return}let{provider:n}=await k(),r=new o.PublicKey(t),i=s.P6.token.associatedAddress({mint:r,owner:e}),l=await n.connection.getTokenAccountBalance(i,"confirmed");a(Number(l.value.uiAmount||0))}catch(e){a(0)}})()},[null==e?void 0:e.toBase58()]);let C=n>=51;(0,l.useEffect)(()=>{(async()=>{try{if(!e||!w){g(!1);return}let{program:t}=await k(),n=new o.PublicKey(w),r=await t.account.table.fetch(n),a=new o.PublicKey(r.operator);g(a.equals(e))}catch(e){g(!1)}})()},[null==e?void 0:e.toBase58(),w]);let[E,T]=(0,l.useState)({});async function S(){m("");try{var t;if(!e)return alert("Connect wallet first");if(!C)return alert("Need GOV >= 51");let n=j();if(!(null==n?void 0:n.signMessage))return alert("Wallet must support signMessage");let r=Date.now(),a="Update social links\nTimestamp: ".concat(r),i=new TextEncoder().encode(a),l=await n.signMessage(i),o=null!==(t=null==l?void 0:l.signature)&&void 0!==t?t:l,s=d().encode(o),c=await fetch("/api/social-links",{method:"POST",headers:{"content-type":"application/json"},body:JSON.stringify({publicKey:e.toBase58(),signature:s,message:a,ts:r,links:E})}),u=await c.json();if(!c.ok)throw Error((null==u?void 0:u.error)||"Failed");m("Saved! Header links updated (may reset on restart).")}catch(e){console.error(e),m("Save failed: "+((null==e?void 0:e.message)||e))}}return(0,l.useEffect)(()=>{(async()=>{try{let e=await fetch("/api/social-links");if(!e.ok)return;let t=await e.json();(null==t?void 0:t.links)&&T(t.links)}catch(e){}})()},[]),(0,r.jsxs)("div",{children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{children:"Admin – Provably-Fair Roulette"})}),(0,r.jsxs)("main",{className:"container",children:[(0,r.jsx)(h.Z,{showAdminLink:!0}),(0,r.jsxs)("section",{className:"card",children:[(0,r.jsx)("h1",{style:{marginTop:0},children:"Admin"}),(0,r.jsxs)("div",{className:"space-between",children:[(0,r.jsxs)("div",{className:"muted",style:{fontSize:13},children:["Wallet: ",e?"".concat(e.toBase58().slice(0,6),"…").concat(e.toBase58().slice(-6)):"not connected",(0,r.jsx)("br",{}),"GOV balance: ",n," (need ",51,")"]}),(0,r.jsx)("div",{children:e?(0,r.jsx)("button",{className:"btn-secondary",onClick:N,children:"Disconnect"}):(0,r.jsx)("button",{onClick:A,children:"Connect"})})]}),C?null:(0,r.jsxs)("div",{className:"notice notice-danger",style:{marginTop:12},children:["Access denied. You need GOV ≥ ",51," to use Admin."]}),c?(0,r.jsx)("div",{className:"notice notice-info",style:{marginTop:12},children:c}):null]}),C?(0,r.jsxs)("section",{className:"card",children:[(0,r.jsx)("h2",{style:{marginTop:0},children:"Liquidity"}),(0,r.jsx)("div",{className:"muted",style:{fontSize:13,marginBottom:10},children:"Liquidity actions are still enforced on-chain (operator + GOV threshold)."}),(0,r.jsx)("label",{style:{display:"block",marginBottom:6},children:"Table PDA"}),(0,r.jsx)("input",{value:w,onChange:e=>v(e.target.value.trim()),placeholder:"Table PDA",style:{width:"100%"}}),(0,r.jsxs)("div",{className:"muted",style:{marginTop:10,fontSize:13},children:["Operator: ",p?"yes":"no"]}),(0,r.jsxs)("div",{className:"row",style:{marginTop:12},children:[(0,r.jsx)("input",{id:"dep",type:"number",placeholder:"Deposit (USDC)",defaultValue:10,style:{width:160}}),(0,r.jsx)("button",{disabled:!p,onClick:async()=>{try{var t;if(!e)return alert("Connect wallet");if(!w)return alert("Set table");let{program:n,provider:r}=await k(),a=Number((null===(t=document.getElementById("dep"))||void 0===t?void 0:t.value)||0);await f.ZP.depositLiquidity(n,r,{table:new o.PublicKey(w),amount:Math.round(1e6*a)}),alert("Deposited")}catch(e){console.error(e),alert((null==e?void 0:e.message)||e)}},children:"Deposit"}),(0,r.jsx)("input",{id:"wd",type:"number",placeholder:"Withdraw (USDC)",defaultValue:1,style:{width:160}}),(0,r.jsx)("button",{disabled:!p,onClick:async()=>{try{var t;if(!e)return alert("Connect wallet");if(!w)return alert("Set table");let{program:n,provider:r}=await k(),a=Number((null===(t=document.getElementById("wd"))||void 0===t?void 0:t.value)||0);await f.ZP.executeWithdraw(n,r,{table:new o.PublicKey(w),amount:Math.round(1e6*a)}),alert("Withdrawn")}catch(e){console.error(e),alert((null==e?void 0:e.message)||e)}},children:"Withdraw"})]})]}):null,C?(0,r.jsxs)("section",{className:"card",children:[(0,r.jsx)("h2",{style:{marginTop:0},children:"Header social links"}),(0,r.jsx)("div",{className:"muted",style:{fontSize:13,marginBottom:10},children:"This updates the running server memory (good for tests). On restart/deploy it resets to env defaults."}),(0,r.jsxs)("div",{style:{display:"grid",gridTemplateColumns:"1fr",gap:10},children:[(0,r.jsxs)("label",{children:["Website",(0,r.jsx)("input",{value:E.website||"",onChange:e=>T(t=>({...t,website:e.target.value})),style:{width:"100%"}})]}),(0,r.jsxs)("label",{children:["X/Twitter",(0,r.jsx)("input",{value:E.twitter||"",onChange:e=>T(t=>({...t,twitter:e.target.value})),style:{width:"100%"}})]}),(0,r.jsxs)("label",{children:["Telegram",(0,r.jsx)("input",{value:E.telegram||"",onChange:e=>T(t=>({...t,telegram:e.target.value})),style:{width:"100%"}})]}),(0,r.jsxs)("label",{children:["Discord",(0,r.jsx)("input",{value:E.discord||"",onChange:e=>T(t=>({...t,discord:e.target.value})),style:{width:"100%"}})]})]}),(0,r.jsx)("div",{style:{marginTop:12},children:(0,r.jsx)("button",{onClick:S,children:"Save"})})]}):null,(0,r.jsx)(u.Z,{})]})]})}}},function(e){e.O(0,[766,861,655,961,139,288,888,774,179],function(){return e(e.s=577)}),_N_E=e.O()}]);