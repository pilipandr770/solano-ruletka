(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1854)}])},1854:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return w}});var r=n(5893),a=n(9),s=n.n(a),l=n(7294),c=n(9008),i=n.n(c),o=n(9917),d=n(9828),u=n(6413),m=n(2872),f=n(5152),b=n.n(f),x=n(5208),h=n(6092),y=n(3439),g=n(3454),p=n(8764).Buffer;let j=b()(()=>n.e(423).then(n.bind(n,423)),{loadableGenerated:{webpack:()=>[423]},ssr:!1});function w(){let[e,t]=(0,l.useState)(null),[n,a]=(0,l.useState)(null),c="https://api.devnet.solana.com",f=(0,l.useMemo)(()=>new o.Connection(c),[c]),b=(0,l.useRef)(0);function w(){var e;let t=window;return t.solana&&t.solana.isPhantom?t.solana:t.solflare?t.solflare:t.solana?t.solana:(null===(e=t.phantom)||void 0===e?void 0:e.solana)?t.phantom.solana:null}let v=(0,l.useCallback)(async()=>{try{let e;let n=w();if(!n)return alert("No supported Solana wallet found in browser (Phantom / Solflare)");try{e=await n.connect({onlyIfTrusted:!1})}catch(t){e=await n.connect()}let r=(null==e?void 0:e.publicKey)||n.publicKey;r?t(new o.PublicKey(r.toString())):alert("Connected but provider did not return a publicKey")}catch(e){console.error("wallet connect failed",e),alert("Wallet connect failed: "+((null==e?void 0:e.message)||e))}},[]),N=(0,l.useCallback)(async()=>{try{await window.solana.disconnect()}catch(e){}t(null),a(null)},[]),k=(0,l.useCallback)(async()=>{if(!e)return a(null);if(!(Date.now()<b.current))try{let t=await f.getBalance(e);a(t/1e9)}catch(t){let e=String((null==t?void 0:t.message)||t);if(e.includes("429")||e.includes("Too many requests")){b.current=Date.now()+15e3;return}console.warn("getBalance failed:",t)}},[e,f]);async function S(){if(!e)throw Error("Connect wallet first");let t=w();if(!t)throw Error("Wallet not connected");let n=new d.Y7(f,t,{preflightCommitment:"confirmed"}),r="ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt";if(!r)throw Error("NEXT_PUBLIC_PROGRAM_ID is missing");let a=new o.PublicKey(r),{program:s}=await m.ZP.initProgram(x,a,n);return{program:s,provider:n}}(0,l.useEffect)(()=>{k();let e=setInterval(()=>k(),15e3);return()=>clearInterval(e)},[k]),(0,l.useEffect)(()=>{let e=w();if(!e)return;let n=()=>{try{t(new o.PublicKey(e.publicKey.toString()))}catch(e){}},r=()=>{t(null),a(null)};return e.on&&e.on("connect",n),e.on&&e.on("disconnect",r),(e.isConnected||e.connected)&&n(),()=>{e.removeListener&&e.removeListener("connect",n),e.removeListener&&e.removeListener("disconnect",r)}},[]);let[P,C]=(0,l.useState)(!1),[T,B]=(0,l.useState)(0),[A,R]=(0,l.useState)(0),z="GrSGzfP8B7fpbiE4mAAJRxW3bvvumdAXiBYb84ggt1Jk",D="67aWHV5cwANX6ZkHSdDiW87ksqbzHzukCsSrasxPb3R4",E=g.env.NEXT_PUBLIC_TABLE_PDAS||"",I=!!E.trim(),L=(0,l.useMemo)(()=>{let e=[D,...E.split(/[\s,]+/g)].filter(Boolean),t=new Set,n=[];for(let r of e){let e=String(r).trim();if(e&&!t.has(e)){try{new o.PublicKey(e)}catch(e){continue}t.add(e),n.push(e)}}return n},[D,E]),M=!!D&&!I,W=A>=51;(0,l.useEffect)(()=>{(async()=>{try{if(!e||!z){R(0);return}let{provider:t}=await S(),n=new o.PublicKey(z),r=d.P6.token.associatedAddress({mint:n,owner:e}),a=await t.connection.getTokenAccountBalance(r,"confirmed");R(Number(a.value.uiAmount||0))}catch(e){R(0)}})()},[null==e?void 0:e.toBase58(),z]);let[U,_]=(0,l.useState)("67aWHV5cwANX6ZkHSdDiW87ksqbzHzukCsSrasxPb3R4");(0,l.useEffect)(()=>{if(I){try{var e;let t=null===(e=window.localStorage.getItem("selectedTablePda"))||void 0===e?void 0:e.trim();if(t&&L.includes(t)){_(t);return}}catch(e){}L.length>0&&!U&&_(L[0])}},[I,L]);let K=(0,l.useMemo)(()=>I?!U||L.includes(U)?L:[U,...L]:[],[I,L,U]);(0,l.useEffect)(()=>{(async()=>{try{let t;if(!e||!U){C(!1),B(0);return}let{program:n,provider:r}=await S();try{t=new o.PublicKey(U)}catch(e){C(!1),B(0);return}let a=await n.account.table.fetch(t),s=new o.PublicKey(a.operator);C(s.equals(e));let l=new o.PublicKey(a.govMint),c=d.P6.token.associatedAddress({mint:l,owner:e}),i=await r.connection.getTokenAccountBalance(c,"confirmed");B(Number(i.value.uiAmount||0))}catch(e){C(!1),B(0)}})()},[null==e?void 0:e.toBase58(),U]),(0,l.useCallback)(async()=>{try{if(!W)return alert("Only functional-token owners (GOV >= 51) can create tables");let{program:t,provider:n}=await S(),r=Math.floor(1e6*Math.random());await m.ZP.createTable(t,n,{seed:r,usdcMint:"9sNnTsxUPfLApmVzcoyA64VoaPhdCLynfQTM33hDfNdL",govMint:"GrSGzfP8B7fpbiE4mAAJRxW3bvvumdAXiBYb84ggt1Jk",mode:0,minBet:1,maxBet:1e6});let[a]=d.rV.PublicKey.findProgramAddressSync([p.from("table"),e.toBuffer(),new d.BN(r).toArrayLike(p,"le",8)],new o.PublicKey("ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt"));_(a.toBase58()),alert("createTable sent, table address set")}catch(e){console.error(e),alert((null==e?void 0:e.message)||e)}},[e,f]);let[O,F]=(0,l.useState)(null),[V,q]=(0,l.useState)(null),[Z,X]=(0,l.useState)(null),[G,H]=(0,l.useState)(null),[J,Y]=(0,l.useState)("straight"),[Q,$]=(0,l.useState)(1),[ee,et]=(0,l.useState)(Math.floor(1e6*Math.random())),[en,er]=(0,l.useState)([]),[ea,es]=(0,l.useState)(""),[el,ec]=(0,l.useState)(null),[ei,eo]=(0,l.useState)(null),[ed,eu]=(0,l.useState)("idle"),[em,ef]=(0,l.useState)(null),[eb,ex]=(0,l.useState)(0),[eh,ey]=(0,l.useState)(!1),[eg,ep]=(0,l.useState)(""),ej=(0,l.useRef)(0),ew=(0,l.useRef)(null),ev=(0,l.useRef)("stopped"),eN=(0,l.useRef)(0),ek=(0,l.useMemo)(()=>[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26],[]);function eS(e){return 0===e?"green":new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]).has(e)?"red":"black"}let eP=(0,l.useMemo)(()=>{let e=360/ek.length,t=[];for(let n=0;n<ek.length;n++){let r=ek[n],a=n*e,s=(n+1)*e,l=eS(r),c="green"===l?"#155724":"red"===l?"#721c24":"#111";t.push("".concat(c," ").concat(a,"deg ").concat(s,"deg"))}return"conic-gradient(from 0deg, ".concat(t.join(", "),")")},[ek]);function eC(){null!==ew.current&&(cancelAnimationFrame(ew.current),ew.current=null),ev.current="stopped"}function eT(e,t){ej.current=e,t-eN.current>16&&(eN.current=t,ex(e))}function eB(){F(null),q(null),X(null),H(null),$(1),Y("straight"),er([]),ey(!1),ep("")}async function eA(){if(eo(null),!e){eo({kind:"error",text:"Connect wallet first"});return}if("straight"===J&&null===O)return eo({kind:"error",text:"Select a number to bet on"});if("split"===J&&(!V||V[0]===V[1]))return eo({kind:"error",text:"Select two adjacent numbers for split"});if("split"===J&&Z)return eo({kind:"error",text:"For corner bets switch bet type to corner"});if("street"===J&&(!G||3!==G.length))return eo({kind:"error",text:"Select a street (row of 3 numbers)"});if("corner"===J&&(!Z||4!==Z.length))return eo({kind:"error",text:"Select a valid corner (4 numbers)"});if(("dozen"===J||"column"===J)&&null===O)return eo({kind:"error",text:"Select a dozen/column first"});try{let t;let{program:n,provider:r}=await S();if(!U)return eo({kind:"error",text:"Set table address in the Table section above"});if("ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt"===U)return eo({kind:"error",text:"Table address is ProgramId. Create/select a real table PDA address."});try{t=new o.PublicKey(U)}catch(e){return eo({kind:"error",text:"Invalid table address"})}let a=null;if("straight"===J)a={straight:{number:O}};else if("split"===J)a={split:{a:V[0],b:V[1]}};else if("street"===J)a={street:{row:Math.floor((G[0]-1)/3)+1}};else if("corner"===J){let e=Math.min(...Z);a={corner:{row:Math.floor((e-1)/3)+1,col:(e-1)%3+1}}}else if("red"===J)a={red:{}};else if("black"===J)a={black:{}};else if("dozen"===J){if(1!==O&&2!==O&&3!==O)return eo({kind:"error",text:"Dozen idx must be 1,2,3"});a={dozen:{idx:O}}}else if("column"===J){if(1!==O&&2!==O&&3!==O)return eo({kind:"error",text:"Column idx must be 1,2,3"});a={column:{idx:O}}}let s=Math.round(1e6*Number(Q)),l=await n.account.table.fetch(t),c=new o.PublicKey(l.usdcMint),i=function(e){switch(e){case"straight":return 35;case"split":return 17;case"street":return 11;case"corner":return 8;case"red":case"black":default:return 1;case"dozen":case"column":return 2}}(J),d=BigInt(s)*BigInt(i+1),f=await m.ZP.getGlobalLiquidity(r,n.programId,c,"confirmed");if(f.available<d){let e=d-f.available;return eo({kind:"error",text:"Insufficient liquidity. Available: ".concat(Number(f.available)/1e6," USDC. ")+"Required: ".concat(Number(d)/1e6," USDC. ")+"Missing: ".concat(Number(e)/1e6," USDC.")})}let b=0;try{let t=(0,u.MO)(c,e),n=await r.connection.getTokenAccountBalance(t,"confirmed");b=Number(n.value.uiAmount||0)}catch(e){b=0}if(Math.floor(1e6*b)<s)return eo({kind:"error",text:"Insufficient USDC in your wallet. Have: ".concat(b," USDC. ")+"Need: ".concat((s/1e6).toFixed(6)," USDC. ")+"Go to /get-tokens or ask the operator to send you test USDC."});eo({kind:"info",text:"Bet submitted. Waiting for randomness…"});let x=await m.ZP.placeBet(n,r,{table:t,betKind:a,stake:s});es(x.betPda),ep(x.randomPda),ey(!1),eu("waiting"),eo({kind:"info",text:"Ставка принята. Ждём подтверждение случайности (VRF)…"})}catch(e){console.error(e),eo({kind:"error",text:"placeBet failed: "+((null==e?void 0:e.message)||e)})}}(0,l.useEffect)(()=>{if("waiting"===ed||"spinning"===ed){!function(){if("free"===ev.current)return;eC(),ev.current="free";let e=performance.now(),t=n=>{if("free"!==ev.current)return;let r=Math.max(0,n-e)/1e3;e=n,eT(ej.current+720*r,n),ew.current=requestAnimationFrame(t)};ew.current=requestAnimationFrame(t)}();return}if("revealed"===ed&&null!==em){!function(e){eC(),ev.current="settling";let t=360/ek.length,n=ek.indexOf(e);if(n<0)return;let r=ej.current,a=performance.now(),s=r+2160+((-(n*t+t/2)%360+360)%360-(r%360+360)%360+360)%360,l=e=>{if("settling"!==ev.current)return;let t=Math.min(1,(e-a)/2600);eT(r+(s-r)*(1-Math.pow(1-t,3)),e),t<1?ew.current=requestAnimationFrame(l):(ev.current="stopped",ew.current=null)};ew.current=requestAnimationFrame(l)}(em);return}eC()},[ed,em]),(0,l.useEffect)(()=>()=>eC(),[]),(0,l.useEffect)(()=>{let t=!1;return(async()=>{try{if(!eg||!e||!U||eh||"waiting"!==ed)return;let{provider:n}=await S(),r=new o.PublicKey(eg),a=Date.now();for(;!t&&Date.now()-a<3e4;){if((await m.ZP.getOraoRandomnessV2Fulfilled(n,r,"confirmed")).fulfilled){if(t)return;ey(!0),eu("idle"),eo({kind:"success",text:"Случайность подтверждена (VRF). Нажми SPIN, чтобы открыть результат."});return}await new Promise(e=>setTimeout(e,1200))}t||eo({kind:"info",text:"Ждём подтверждение VRF… Это занимает 5–15 секунд. Если долго — попробуй ещё раз через пару секунд."})}catch(e){t||console.warn("VRF readiness poll failed:",e)}})(),()=>{t=!0}},[eg,ed,null==e?void 0:e.toBase58(),U,eh]);let eR="straight"===J?null===O?"—":String(O):"split"===J?V?"".concat(V[0]," / ").concat(V[1]):"—":"corner"===J?Z?Z.join(", "):"—":"street"===J?G?G.join(", "):"—":"red"===J||"black"===J?J.toUpperCase():"—";return(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{className:"jsx-475590cc5d45b8e1",children:"Provably-Fair Roulette"})}),(0,r.jsx)(s(),{id:"475590cc5d45b8e1",children:"@-webkit-keyframes popIn{from{-webkit-transform:scale(.9);transform:scale(.9);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:1}}@-moz-keyframes popIn{from{-moz-transform:scale(.9);transform:scale(.9);opacity:0}to{-moz-transform:scale(1);transform:scale(1);opacity:1}}@-o-keyframes popIn{from{-o-transform:scale(.9);transform:scale(.9);opacity:0}to{-o-transform:scale(1);transform:scale(1);opacity:1}}@keyframes popIn{from{-webkit-transform:scale(.9);-moz-transform:scale(.9);-o-transform:scale(.9);transform:scale(.9);opacity:0}to{-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1);opacity:1}}@-webkit-keyframes ballOrbit{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes ballOrbit{from{-moz-transform:rotate(0deg);transform:rotate(0deg)}to{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes ballOrbit{from{-o-transform:rotate(0deg);transform:rotate(0deg)}to{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes ballOrbit{from{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"}),(0,r.jsxs)("main",{className:"jsx-475590cc5d45b8e1 container",children:[(0,r.jsx)(y.Z,{showAdminLink:W}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 space-between",children:[(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("h2",{style:{margin:"0 0 6px 0"},className:"jsx-475590cc5d45b8e1",children:"Wallet & Network"}),(0,r.jsxs)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:["devnet"," • provably-fair VRF roulette demo"]})]}),(0,r.jsx)("div",{className:"jsx-475590cc5d45b8e1 row",children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:[e.toBase58().slice(0,6),"…",e.toBase58().slice(-6)]}),(0,r.jsx)("button",{onClick:N,className:"jsx-475590cc5d45b8e1 btn-secondary",children:"Disconnect"})]}):(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsx)("button",{onClick:v,className:"jsx-475590cc5d45b8e1",children:"Connect wallet"}),(0,r.jsx)("a",{href:"https://solflare.com/",target:"_blank",rel:"noreferrer",style:{fontSize:13,textDecoration:"none"},className:"jsx-475590cc5d45b8e1 muted",children:"Install Solflare"})]})})]}),(0,r.jsxs)("div",{style:{marginTop:14},className:"jsx-475590cc5d45b8e1 grid grid-2",children:[(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"RPC:"})," ",(0,r.jsx)("span",{style:{wordBreak:"break-all"},className:"jsx-475590cc5d45b8e1",children:c})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"Program:"})," ",(0,r.jsx)("span",{style:{wordBreak:"break-all"},className:"jsx-475590cc5d45b8e1",children:"ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt"})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"Wallet:"})," ",(0,r.jsx)("span",{style:{wordBreak:"break-all"},className:"jsx-475590cc5d45b8e1",children:e?e.toBase58():"Not connected"})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"SOL:"})," ",null!==n?n.toFixed(4):"—"]})]})]}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsx)("h2",{className:"jsx-475590cc5d45b8e1",children:"Table"}),I&&K.length>0?(0,r.jsxs)("div",{style:{marginBottom:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:6},className:"jsx-475590cc5d45b8e1",children:"Select table"}),(0,r.jsx)("select",{value:K.includes(U)?U:K[0],onChange:e=>{let t=e.target.value.trim();_(t);try{window.localStorage.setItem("selectedTablePda",t)}catch(e){}},style:{width:"100%"},className:"jsx-475590cc5d45b8e1",children:K.map(e=>(0,r.jsxs)("option",{value:e,className:"jsx-475590cc5d45b8e1",children:[e.slice(0,4),"…",e.slice(-4)]},e))}),(0,r.jsx)("div",{style:{fontSize:13,marginTop:6},className:"jsx-475590cc5d45b8e1 muted",children:"Add/remove tables via NEXT_PUBLIC_TABLE_PDAS (comma-separated) in Render."})]}):null,W?(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsxs)("label",{style:{gap:8},className:"jsx-475590cc5d45b8e1 row",children:["Table number (seed):",(0,r.jsx)("input",{type:"number",value:ee,onChange:e=>et(Number(e.target.value||0)),style:{width:160},className:"jsx-475590cc5d45b8e1"})]}),(0,r.jsx)("button",{onClick:async()=>{try{if(!e)return alert("Connect wallet first");let{program:t,provider:n}=await S(),r=Number.isFinite(ee)?Math.floor(ee):Math.floor(1e6*Math.random()),a=(await m.ZP.createTable(t,n,{seed:r,usdcMint:"9sNnTsxUPfLApmVzcoyA64VoaPhdCLynfQTM33hDfNdL",govMint:"GrSGzfP8B7fpbiE4mAAJRxW3bvvumdAXiBYb84ggt1Jk",mode:0,minBet:1e4,maxBet:1e9})).tablePda;_(a);let s=0;for(;s<10;){if(await new Promise(e=>setTimeout(e,1e3)),await f.getAccountInfo(new o.PublicKey(a))){alert("Table created successfully! Address: "+a);return}s++}alert("Table tx sent but account not yet visible. Address: "+a)}catch(e){console.error(e),alert("createTable failed: "+((null==e?void 0:e.message)||e))}},className:"jsx-475590cc5d45b8e1",children:"Create Table"})]}):(0,r.jsx)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:"Table creation is available only to functional-token owners."}),(0,r.jsxs)("div",{style:{marginTop:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("div",{style:{fontSize:13,color:"#666"},className:"jsx-475590cc5d45b8e1",children:U?"Table: configured (".concat(U.slice(0,4),"…").concat(U.slice(-4),")"):"Table: not configured (operator must set NEXT_PUBLIC_TABLE_PDA / NEXT_PUBLIC_TABLE_PDAS, or create a table)"}),M||I||!W?null:(0,r.jsxs)("div",{style:{marginTop:10},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:6},className:"jsx-475590cc5d45b8e1",children:"Table address (PDA) (owner only)"}),(0,r.jsx)("input",{value:U,onChange:e=>_(e.target.value.trim()),placeholder:"Paste table PDA here",style:{width:"100%"},className:"jsx-475590cc5d45b8e1"})]})]}),P&&T>=51?(0,r.jsxs)("div",{style:{marginTop:16,background:"#fff3cd",borderColor:"rgba(0,0,0,0.08)"},className:"jsx-475590cc5d45b8e1 notice",children:[(0,r.jsx)("h3",{style:{margin:"0 0 8px 0",fontSize:15},className:"jsx-475590cc5d45b8e1",children:"Deposit Liquidity (Required before bets)"}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsx)("input",{type:"number",placeholder:"Amount (USDC)",id:"liquidityAmount",style:{width:150},defaultValue:10,className:"jsx-475590cc5d45b8e1"}),(0,r.jsx)("button",{onClick:async()=>{try{var t;if(!e)return alert("Connect wallet first");if(!U)return alert("Set table address first");let{program:n,provider:r}=await S(),a=Number((null===(t=document.getElementById("liquidityAmount"))||void 0===t?void 0:t.value)||0);if(!a||a<=0)return alert("Enter valid amount");let s=new o.PublicKey(U);await m.ZP.depositLiquidity(n,r,{table:s,amount:Math.round(1e6*a)}),alert("Liquidity deposited successfully!")}catch(e){console.error(e),alert("depositLiquidity failed: "+((null==e?void 0:e.message)||e))}},className:"jsx-475590cc5d45b8e1",children:"Deposit Liquidity"}),(0,r.jsx)("span",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:"Operators must fund the vault before players can bet"})]}),(0,r.jsxs)("div",{style:{marginTop:10},className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsx)("input",{type:"number",placeholder:"Withdraw (USDC)",id:"withdrawAmount",style:{width:150},defaultValue:1,className:"jsx-475590cc5d45b8e1"}),(0,r.jsx)("button",{onClick:async()=>{try{var t;if(!e)return alert("Connect wallet first");if(!U)return alert("Set table address first");let{program:n,provider:r}=await S(),a=Number((null===(t=document.getElementById("withdrawAmount"))||void 0===t?void 0:t.value)||0);if(!a||a<=0)return alert("Enter valid amount");let s=new o.PublicKey(U);await m.ZP.executeWithdraw(n,r,{table:s,amount:Math.round(1e6*a)}),alert("Liquidity withdrawn successfully!")}catch(e){console.error(e),alert("withdraw failed: "+((null==e?void 0:e.message)||e))}},className:"jsx-475590cc5d45b8e1",children:"Withdraw Liquidity"}),(0,r.jsx)("span",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:"Withdraw rules depend on table mode (PUBLIC has delay)"})]})]}):null]}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsx)("h2",{className:"jsx-475590cc5d45b8e1",children:"Resolve Bet (Spin Roulette)"}),(0,r.jsxs)("div",{style:{display:"flex",gap:18,alignItems:"center",flexWrap:"wrap",marginBottom:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{width:140,height:140,borderRadius:"50%",border:"10px solid #f7f7f7",position:"relative",background:eP,boxShadow:"inset 0 0 0 2px rgba(255,255,255,0.65)",transform:"rotate(".concat(eb+-360/37/2,"deg)")},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("div",{style:{position:"absolute",top:-12,left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderBottom:"16px solid #333"},className:"jsx-475590cc5d45b8e1"}),("waiting"===ed||"spinning"===ed)&&(0,r.jsx)("div",{style:{position:"absolute",inset:8,borderRadius:"50%",animation:"ballOrbit 0.55s linear infinite"},className:"jsx-475590cc5d45b8e1",children:(0,r.jsx)("div",{style:{position:"absolute",top:-2,left:"50%",transform:"translateX(-50%)",width:10,height:10,borderRadius:"50%",background:"#fff",boxShadow:"0 0 0 2px rgba(0,0,0,0.15)"},className:"jsx-475590cc5d45b8e1"})}),(0,r.jsx)("div",{style:{position:"absolute",inset:18,borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:36,animation:"revealed"===ed?"popIn 220ms ease-out":void 0,color:null===em?"#333":"red"===eS(em)?"#721c24":"green"===eS(em)?"#155724":"#111"},className:"jsx-475590cc5d45b8e1",children:null===em?"—":em})]}),(0,r.jsxs)("div",{style:{minWidth:320},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{fontSize:14,color:"#555",marginBottom:6},className:"jsx-475590cc5d45b8e1",children:["waiting"===ed&&"Waiting for ORAO VRF…","spinning"===ed&&"Spinning…","revealed"===ed&&"Result","idle"===ed&&"Ready"]}),ei&&(0,r.jsx)("div",{className:"jsx-475590cc5d45b8e1 "+"notice ".concat("success"===ei.kind?"notice-success":"error"===ei.kind?"notice-danger":"notice-info"),children:ei.text}),el&&(0,r.jsx)("div",{style:{marginTop:10,fontSize:15,fontWeight:700},className:"jsx-475590cc5d45b8e1",children:el.win?"WIN: +".concat(el.payout," USDC"):"LOSS"})]})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 notice notice-info",children:[(0,r.jsx)("p",{style:{margin:"0 0 12px 0",fontSize:14},className:"jsx-475590cc5d45b8e1",children:"Сначала делаем ставку. Затем ORAO VRF подтверждает случайность (это защищает от подкрутки). Когда будет готово — нажми SPIN."}),(0,r.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},className:"jsx-475590cc5d45b8e1",children:(0,r.jsx)("button",{disabled:!ea||!U||"waiting"===ed||"spinning"===ed,onClick:async()=>{try{if(eo(null),!e){eo({kind:"error",text:"Connect wallet first"});return}if(!U){eo({kind:"error",text:"Set table address first"});return}let t=null==ea?void 0:ea.trim();if(!t)return eo({kind:"error",text:"Сначала сделай ставку"});let{program:n,provider:r}=await S(),a=new o.PublicKey(U),s=new o.PublicKey(t);if(eh||(eu("waiting"),ef(null),eo({kind:"info",text:"Ждём подтверждение VRF…"})),!await r.connection.getAccountInfo(s)){eu("idle"),eo({kind:"error",text:"Bet account not found"});return}try{let e=await m.ZP.getBet(r,s,"confirmed");if(e.isSettled||(e=await m.ZP.getBet(r,s,"finalized")),e.isSettled&&null!==e.resultNumber){let t=e.payout>0n;eu("revealed"),ef(e.resultNumber),ec({number:e.resultNumber,win:t,payout:Number(e.payout)/1e6}),eB(),eo({kind:t?"success":"info",text:t?"Already resolved. Result ".concat(e.resultNumber,". Won ").concat(Number(e.payout)/1e6," USDC."):"Already resolved. Result ".concat(e.resultNumber,". Lost.")});return}}catch(e){}try{let e=(await m.ZP.getBet(r,s,"confirmed")).randomnessAccount,t=Date.now();for(;Date.now()-t<3e4&&!(await m.ZP.getOraoRandomnessV2Fulfilled(r,e,"confirmed")).fulfilled;)await new Promise(e=>setTimeout(e,1500));if(!(await m.ZP.getOraoRandomnessV2Fulfilled(r,e,"confirmed")).fulfilled){eu("waiting"),eo({kind:"info",text:"Randomness not fulfilled yet. Wait 5–15s and try again."});return}}catch(e){console.warn("Randomness poll warning:",e)}eu("spinning"),eo({kind:"info",text:"Spinning…"});let l=await m.ZP.resolveBet(n,r,{table:a,bet:s,player:e});try{await r.connection.confirmTransaction(l,"confirmed")}catch(e){console.warn("confirmTransaction warning:",e)}await new Promise(e=>setTimeout(e,1500));try{let e=await m.ZP.getBet(r,s,"confirmed");if(e.isSettled||(e=await m.ZP.getBet(r,s,"finalized")),e.isSettled&&null!==e.resultNumber){let t=e.payout>0n;eu("revealed"),ef(e.resultNumber),ec({number:e.resultNumber,win:t,payout:Number(e.payout)/1e6}),eB(),eo({kind:t?"success":"info",text:t?"Result ".concat(e.resultNumber,". Won ").concat(Number(e.payout)/1e6," USDC."):"Result ".concat(e.resultNumber,". Lost.")})}else try{let e=await r.connection.getTransaction(l,{commitment:"confirmed",maxSupportedTransactionVersion:0});e&&e.meta&&e.meta.err?(eu("idle"),eo({kind:"error",text:"Resolve transaction failed. Check console for logs."}),console.error("Transaction error:",e.meta.err)):e?(eu("idle"),eo({kind:"info",text:"Tx succeeded but account not updated yet (RPC lag). Try again in a few seconds."})):(eu("idle"),eo({kind:"info",text:"Transaction not found yet (congestion). Wait a bit and retry."}))}catch(e){console.error("Error fetching transaction:",e),eu("idle"),eo({kind:"error",text:"Could not fetch transaction details."})}}catch(e){console.error("Error fetching bet result:",e),eu("idle"),eo({kind:"error",text:"Resolved, but failed to fetch result (RPC lag). Try again."})}}catch(e){console.error(e),eu("idle"),eo({kind:"error",text:"resolveBet failed: "+((null==e?void 0:e.message)||e)})}},className:"jsx-475590cc5d45b8e1",children:eh?"SPIN":ea?"WAIT…":"SPIN"})}),(0,r.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#0c5460"},className:"jsx-475590cc5d45b8e1",children:[!ea&&"Шаг 1: сделай ставку. После этого появится ожидание VRF.",ea&&!eh&&"Шаг 2: идёт проверяемая генерация случайности (VRF). Это нужно для честной рулетки.",ea&&eh&&"Шаг 3: нажми SPIN, чтобы открыть результат и выплату."]})]})]}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsx)("h2",{className:"jsx-475590cc5d45b8e1",children:"Place a bet"}),el&&(0,r.jsxs)("div",{style:{marginBottom:20},className:"jsx-475590cc5d45b8e1 "+"notice ".concat(el.win?"notice-success":"notice-danger"),children:[(0,r.jsxs)("h3",{style:{margin:0},className:"jsx-475590cc5d45b8e1",children:["Last Spin Result: ",el.number]}),(0,r.jsx)("p",{style:{margin:"5px 0 0"},className:"jsx-475590cc5d45b8e1",children:el.win?"YOU WON! Payout: ".concat(el.payout," USDC"):"You lost."})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:24,alignItems:"flex-start",flexWrap:"wrap"},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("div",{style:{flex:"1 1 1024px",maxWidth:"100%",overflowX:"auto"},className:"jsx-475590cc5d45b8e1",children:(0,r.jsx)(j,{mode:J,selected:O,selectedPair:V,selectedCorner:Z,selectedStreet:G,placedBets:en,currentBetType:J,currentStake:Q,onPlace:e=>{er(t=>[...t,e])},onRemove:e=>{er(t=>t.filter((t,n)=>n!==e))},onSelect:e=>{Y("straight"),F(e),q(null),X(null),H(null)},onSelectPair:(e,t)=>{q([e,t]),X(null),F(null),H(null),Y("split")},onSelectCorner:e=>{X(e),q(null),F(null),H(null),Y("corner")},onSelectStreet:e=>{H(e),q(null),X(null),F(null),Y("street")},onSelectDozen:e=>{Y("dozen"),F(e),q(null),X(null),H(null)},onSelectColumn:e=>{Y("column"),F(e),q(null),X(null),H(null)},onSelectOutside:e=>{Y(e),F(null),q(null),X(null),H(null)}})}),(0,r.jsxs)("div",{style:{flex:"1 1 280px",minWidth:260},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{marginBottom:8},className:"jsx-475590cc5d45b8e1",children:["Selected: ",eR]}),(0,r.jsxs)("div",{style:{marginBottom:8},className:"jsx-475590cc5d45b8e1",children:["Stake (USDC): ",(0,r.jsx)("input",{type:"number",value:Q,min:1,onChange:e=>$(Number(e.target.value||1)),style:{width:120},className:"jsx-475590cc5d45b8e1"})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("button",{onClick:eA,className:"jsx-475590cc5d45b8e1",children:"Place Bet"}),(0,r.jsx)("button",{onClick:function(){if(eo(null),"straight"===J&&null===O)return eo({kind:"error",text:"Select a number"});if("split"===J&&(!V||V[0]===V[1]))return eo({kind:"error",text:"Select a valid split"});if("corner"===J&&(!Z||4!==Z.length))return eo({kind:"error",text:"Select a valid corner (4 numbers)"});if("street"===J&&(!G||3!==G.length))return eo({kind:"error",text:"Select a valid street (3 numbers)"});let e=null;e="split"===J?V:"corner"===J?Z:"street"===J?G:O;let t={type:J,value:e,stake:Q};er(e=>[...e,t]),F(null),q(null),$(1)},className:"jsx-475590cc5d45b8e1 btn-secondary",children:"Add Chip"}),(0,r.jsx)("button",{onClick:()=>{F(null),$(1)},className:"jsx-475590cc5d45b8e1 btn-danger",children:"Clear"})]}),(0,r.jsxs)("div",{style:{marginTop:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("h3",{style:{margin:"8px 0"},className:"jsx-475590cc5d45b8e1",children:["Bet Slip (",en.length,")"]}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},className:"jsx-475590cc5d45b8e1",children:[en.map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"#f7f7f7",padding:8,borderRadius:6},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1",children:[e.type," ",Array.isArray(e.value)?JSON.stringify(e.value):String(e.value)]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("input",{type:"number",value:e.stake||Q,min:1,onChange:e=>{let n=Number(e.target.value||1);er(e=>e.map((e,r)=>r===t?{...e,stake:n}:e))},style:{width:80},className:"jsx-475590cc5d45b8e1"}),(0,r.jsx)("button",{onClick:()=>er(e=>e.filter((e,n)=>n!==t)),className:"jsx-475590cc5d45b8e1 btn-secondary",children:"Remove"})]})]},t)),0===en.length&&(0,r.jsx)("div",{className:"jsx-475590cc5d45b8e1 muted",children:"No chips placed"})]})]})]})]})]}),(0,r.jsx)(h.Z,{})]})]})}}},function(e){e.O(0,[766,861,655,961,139,756,288,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);