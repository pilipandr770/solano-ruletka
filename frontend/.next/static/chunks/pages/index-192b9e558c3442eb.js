(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[405],{8312:function(e,t,n){(window.__NEXT_P=window.__NEXT_P||[]).push(["/",function(){return n(1854)}])},1854:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return j}});var r=n(5893),a=n(9),s=n.n(a),l=n(7294),c=n(9008),i=n.n(c),o=n(9917),d=n(9828),u=n(2872),m=n(5152),f=n.n(m),b=n(5208),x=n(6092),h=n(3439),g=n(3454),y=n(8764).Buffer;let p=f()(()=>n.e(423).then(n.bind(n,423)),{loadableGenerated:{webpack:()=>[423]},ssr:!1});function j(){let[e,t]=(0,l.useState)(null),[n,a]=(0,l.useState)(null),c="https://api.devnet.solana.com",m=(0,l.useMemo)(()=>new o.Connection(c),[c]),f=(0,l.useRef)(0);function j(){var e;let t=window;return t.solana&&t.solana.isPhantom?t.solana:t.solflare?t.solflare:t.solana?t.solana:(null===(e=t.phantom)||void 0===e?void 0:e.solana)?t.phantom.solana:null}let w=(0,l.useCallback)(async()=>{try{let e;let n=j();if(!n)return alert("No supported Solana wallet found in browser (Phantom / Solflare)");try{e=await n.connect({onlyIfTrusted:!1})}catch(t){e=await n.connect()}let r=(null==e?void 0:e.publicKey)||n.publicKey;r?t(new o.PublicKey(r.toString())):alert("Connected but provider did not return a publicKey")}catch(e){console.error("wallet connect failed",e),alert("Wallet connect failed: "+((null==e?void 0:e.message)||e))}},[]),v=(0,l.useCallback)(async()=>{try{await window.solana.disconnect()}catch(e){}t(null),a(null)},[]),N=(0,l.useCallback)(async()=>{if(!e)return a(null);if(!(Date.now()<f.current))try{let t=await m.getBalance(e);a(t/1e9)}catch(t){let e=String((null==t?void 0:t.message)||t);if(e.includes("429")||e.includes("Too many requests")){f.current=Date.now()+15e3;return}console.warn("getBalance failed:",t)}},[e,m]);async function k(){if(!e)throw Error("Connect wallet first");let t=j();if(!t)throw Error("Wallet not connected");let n=new d.Y7(m,t,{preflightCommitment:"confirmed"}),r="ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt";if(!r)throw Error("NEXT_PUBLIC_PROGRAM_ID is missing");let a=new o.PublicKey(r),{program:s}=await u.ZP.initProgram(b,a,n);return{program:s,provider:n}}(0,l.useEffect)(()=>{N();let e=setInterval(()=>N(),15e3);return()=>clearInterval(e)},[N]),(0,l.useEffect)(()=>{let e=j();if(!e)return;let n=()=>{try{t(new o.PublicKey(e.publicKey.toString()))}catch(e){}},r=()=>{t(null),a(null)};return e.on&&e.on("connect",n),e.on&&e.on("disconnect",r),(e.isConnected||e.connected)&&n(),()=>{e.removeListener&&e.removeListener("connect",n),e.removeListener&&e.removeListener("disconnect",r)}},[]);let[S,P]=(0,l.useState)(!1),[C,T]=(0,l.useState)(0),[B,A]=(0,l.useState)(0),R="GrSGzfP8B7fpbiE4mAAJRxW3bvvumdAXiBYb84ggt1Jk",z="67aWHV5cwANX6ZkHSdDiW87ksqbzHzukCsSrasxPb3R4",E=g.env.NEXT_PUBLIC_TABLE_PDAS||"",I=!!E.trim(),L=(0,l.useMemo)(()=>{let e=[z,...E.split(/[\s,]+/g)].filter(Boolean),t=new Set,n=[];for(let r of e){let e=String(r).trim();if(e&&!t.has(e)){try{new o.PublicKey(e)}catch(e){continue}t.add(e),n.push(e)}}return n},[z,E]),D=!!z&&!I,W=B>=51;(0,l.useEffect)(()=>{(async()=>{try{if(!e||!R){A(0);return}let{provider:t}=await k(),n=new o.PublicKey(R),r=d.P6.token.associatedAddress({mint:n,owner:e}),a=await t.connection.getTokenAccountBalance(r,"confirmed");A(Number(a.value.uiAmount||0))}catch(e){A(0)}})()},[null==e?void 0:e.toBase58(),R]);let[M,_]=(0,l.useState)("67aWHV5cwANX6ZkHSdDiW87ksqbzHzukCsSrasxPb3R4");(0,l.useEffect)(()=>{if(I){try{var e;let t=null===(e=window.localStorage.getItem("selectedTablePda"))||void 0===e?void 0:e.trim();if(t&&L.includes(t)){_(t);return}}catch(e){}L.length>0&&!M&&_(L[0])}},[I,L]);let K=(0,l.useMemo)(()=>I?!M||L.includes(M)?L:[M,...L]:[],[I,L,M]);(0,l.useEffect)(()=>{(async()=>{try{let t;if(!e||!M){P(!1),T(0);return}let{program:n,provider:r}=await k();try{t=new o.PublicKey(M)}catch(e){P(!1),T(0);return}let a=await n.account.table.fetch(t),s=new o.PublicKey(a.operator);P(s.equals(e));let l=new o.PublicKey(a.govMint),c=d.P6.token.associatedAddress({mint:l,owner:e}),i=await r.connection.getTokenAccountBalance(c,"confirmed");T(Number(i.value.uiAmount||0))}catch(e){P(!1),T(0)}})()},[null==e?void 0:e.toBase58(),M]),(0,l.useCallback)(async()=>{try{if(!W)return alert("Only functional-token owners (GOV >= 51) can create tables");let{program:t,provider:n}=await k(),r=Math.floor(1e6*Math.random());await u.ZP.createTable(t,n,{seed:r,usdcMint:"9sNnTsxUPfLApmVzcoyA64VoaPhdCLynfQTM33hDfNdL",govMint:"GrSGzfP8B7fpbiE4mAAJRxW3bvvumdAXiBYb84ggt1Jk",mode:0,minBet:1,maxBet:1e6});let[a]=d.rV.PublicKey.findProgramAddressSync([y.from("table"),e.toBuffer(),new d.BN(r).toArrayLike(y,"le",8)],new o.PublicKey("ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt"));_(a.toBase58()),alert("createTable sent, table address set")}catch(e){console.error(e),alert((null==e?void 0:e.message)||e)}},[e,m]);let[O,U]=(0,l.useState)(null),[V,F]=(0,l.useState)(null),[q,Z]=(0,l.useState)(null),[X,G]=(0,l.useState)(null),[J,H]=(0,l.useState)("straight"),[Y,Q]=(0,l.useState)(1),[$,ee]=(0,l.useState)(Math.floor(1e6*Math.random())),[et,en]=(0,l.useState)([]),[er,ea]=(0,l.useState)(""),[es,el]=(0,l.useState)(null),[ec,ei]=(0,l.useState)(null),[eo,ed]=(0,l.useState)("idle"),[eu,em]=(0,l.useState)(null),[ef,eb]=(0,l.useState)(0),[ex,eh]=(0,l.useState)(!1),[eg,ey]=(0,l.useState)(""),ep=(0,l.useRef)(0),ej=(0,l.useRef)(null),ew=(0,l.useRef)("stopped"),ev=(0,l.useRef)(0),eN=(0,l.useMemo)(()=>[0,32,15,19,4,21,2,25,17,34,6,27,13,36,11,30,8,23,10,5,24,16,33,1,20,14,31,9,22,18,29,7,28,12,35,3,26],[]);function ek(e){return 0===e?"green":new Set([1,3,5,7,9,12,14,16,18,19,21,23,25,27,30,32,34,36]).has(e)?"red":"black"}let eS=(0,l.useMemo)(()=>{let e=360/eN.length,t=[];for(let n=0;n<eN.length;n++){let r=eN[n],a=n*e,s=(n+1)*e,l=ek(r),c="green"===l?"#155724":"red"===l?"#721c24":"#111";t.push("".concat(c," ").concat(a,"deg ").concat(s,"deg"))}return"conic-gradient(from 0deg, ".concat(t.join(", "),")")},[eN]);function eP(){null!==ej.current&&(cancelAnimationFrame(ej.current),ej.current=null),ew.current="stopped"}function eC(e,t){ep.current=e,t-ev.current>16&&(ev.current=t,eb(e))}function eT(){U(null),F(null),Z(null),G(null),Q(1),H("straight"),en([]),eh(!1),ey("")}async function eB(){if(ei(null),!e){ei({kind:"error",text:"Connect wallet first"});return}if("straight"===J&&null===O)return ei({kind:"error",text:"Select a number to bet on"});if("split"===J&&(!V||V[0]===V[1]))return ei({kind:"error",text:"Select two adjacent numbers for split"});if("split"===J&&q)return ei({kind:"error",text:"For corner bets switch bet type to corner"});if("street"===J&&(!X||3!==X.length))return ei({kind:"error",text:"Select a street (row of 3 numbers)"});if("corner"===J&&(!q||4!==q.length))return ei({kind:"error",text:"Select a valid corner (4 numbers)"});if(("dozen"===J||"column"===J)&&null===O)return ei({kind:"error",text:"Select a dozen/column first"});try{let e;let{program:t,provider:n}=await k();if(!M)return ei({kind:"error",text:"Set table address in the Table section above"});if("ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt"===M)return ei({kind:"error",text:"Table address is ProgramId. Create/select a real table PDA address."});try{e=new o.PublicKey(M)}catch(e){return ei({kind:"error",text:"Invalid table address"})}let r=null;if("straight"===J)r={straight:{number:O}};else if("split"===J)r={split:{a:V[0],b:V[1]}};else if("street"===J)r={street:{row:Math.floor((X[0]-1)/3)+1}};else if("corner"===J){let e=Math.min(...q);r={corner:{row:Math.floor((e-1)/3)+1,col:(e-1)%3+1}}}else if("red"===J)r={red:{}};else if("black"===J)r={black:{}};else if("dozen"===J){if(1!==O&&2!==O&&3!==O)return ei({kind:"error",text:"Dozen idx must be 1,2,3"});r={dozen:{idx:O}}}else if("column"===J){if(1!==O&&2!==O&&3!==O)return ei({kind:"error",text:"Column idx must be 1,2,3"});r={column:{idx:O}}}let a=Math.round(1e6*Number(Y)),s=await t.account.table.fetch(e),l=new o.PublicKey(s.usdcMint),c=function(e){switch(e){case"straight":return 35;case"split":return 17;case"street":return 11;case"corner":return 8;case"red":case"black":default:return 1;case"dozen":case"column":return 2}}(J),i=BigInt(a)*BigInt(c+1),d=await u.ZP.getGlobalLiquidity(n,t.programId,l,"confirmed");if(d.available<i){let e=i-d.available;return ei({kind:"error",text:"Insufficient liquidity. Available: ".concat(Number(d.available)/1e6," USDC. ")+"Required: ".concat(Number(i)/1e6," USDC. ")+"Missing: ".concat(Number(e)/1e6," USDC.")})}ei({kind:"info",text:"Bet submitted. Waiting for randomness…"});let m=await u.ZP.placeBet(t,n,{table:e,betKind:r,stake:a});ea(m.betPda),ey(m.randomPda),eh(!1),ed("waiting"),ei({kind:"info",text:"Ставка принята. Ждём подтверждение случайности (VRF)…"})}catch(e){console.error(e),ei({kind:"error",text:"placeBet failed: "+((null==e?void 0:e.message)||e)})}}(0,l.useEffect)(()=>{if("waiting"===eo||"spinning"===eo){!function(){if("free"===ew.current)return;eP(),ew.current="free";let e=performance.now(),t=n=>{if("free"!==ew.current)return;let r=Math.max(0,n-e)/1e3;e=n,eC(ep.current+720*r,n),ej.current=requestAnimationFrame(t)};ej.current=requestAnimationFrame(t)}();return}if("revealed"===eo&&null!==eu){!function(e){eP(),ew.current="settling";let t=360/eN.length,n=eN.indexOf(e);if(n<0)return;let r=ep.current,a=performance.now(),s=r+2160+((-(n*t+t/2)%360+360)%360-(r%360+360)%360+360)%360,l=e=>{if("settling"!==ew.current)return;let t=Math.min(1,(e-a)/2600);eC(r+(s-r)*(1-Math.pow(1-t,3)),e),t<1?ej.current=requestAnimationFrame(l):(ew.current="stopped",ej.current=null)};ej.current=requestAnimationFrame(l)}(eu);return}eP()},[eo,eu]),(0,l.useEffect)(()=>()=>eP(),[]),(0,l.useEffect)(()=>{let t=!1;return(async()=>{try{if(!eg||!e||!M||ex||"waiting"!==eo)return;let{provider:n}=await k(),r=new o.PublicKey(eg),a=Date.now();for(;!t&&Date.now()-a<3e4;){if((await u.ZP.getOraoRandomnessV2Fulfilled(n,r,"confirmed")).fulfilled){if(t)return;eh(!0),ed("idle"),ei({kind:"success",text:"Случайность подтверждена (VRF). Нажми SPIN, чтобы открыть результат."});return}await new Promise(e=>setTimeout(e,1200))}t||ei({kind:"info",text:"Ждём подтверждение VRF… Это занимает 5–15 секунд. Если долго — попробуй ещё раз через пару секунд."})}catch(e){t||console.warn("VRF readiness poll failed:",e)}})(),()=>{t=!0}},[eg,eo,null==e?void 0:e.toBase58(),M,ex]);let eA="straight"===J?null===O?"—":String(O):"split"===J?V?"".concat(V[0]," / ").concat(V[1]):"—":"corner"===J?q?q.join(", "):"—":"street"===J?X?X.join(", "):"—":"red"===J||"black"===J?J.toUpperCase():"—";return(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)(i(),{children:(0,r.jsx)("title",{className:"jsx-475590cc5d45b8e1",children:"Provably-Fair Roulette"})}),(0,r.jsx)(s(),{id:"475590cc5d45b8e1",children:"@-webkit-keyframes popIn{from{-webkit-transform:scale(.9);transform:scale(.9);opacity:0}to{-webkit-transform:scale(1);transform:scale(1);opacity:1}}@-moz-keyframes popIn{from{-moz-transform:scale(.9);transform:scale(.9);opacity:0}to{-moz-transform:scale(1);transform:scale(1);opacity:1}}@-o-keyframes popIn{from{-o-transform:scale(.9);transform:scale(.9);opacity:0}to{-o-transform:scale(1);transform:scale(1);opacity:1}}@keyframes popIn{from{-webkit-transform:scale(.9);-moz-transform:scale(.9);-o-transform:scale(.9);transform:scale(.9);opacity:0}to{-webkit-transform:scale(1);-moz-transform:scale(1);-o-transform:scale(1);transform:scale(1);opacity:1}}@-webkit-keyframes ballOrbit{from{-webkit-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);transform:rotate(360deg)}}@-moz-keyframes ballOrbit{from{-moz-transform:rotate(0deg);transform:rotate(0deg)}to{-moz-transform:rotate(360deg);transform:rotate(360deg)}}@-o-keyframes ballOrbit{from{-o-transform:rotate(0deg);transform:rotate(0deg)}to{-o-transform:rotate(360deg);transform:rotate(360deg)}}@keyframes ballOrbit{from{-webkit-transform:rotate(0deg);-moz-transform:rotate(0deg);-o-transform:rotate(0deg);transform:rotate(0deg)}to{-webkit-transform:rotate(360deg);-moz-transform:rotate(360deg);-o-transform:rotate(360deg);transform:rotate(360deg)}}"}),(0,r.jsxs)("main",{className:"jsx-475590cc5d45b8e1 container",children:[(0,r.jsx)(h.Z,{showAdminLink:W}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 space-between",children:[(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("h2",{style:{margin:"0 0 6px 0"},className:"jsx-475590cc5d45b8e1",children:"Wallet & Network"}),(0,r.jsxs)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:["devnet"," • provably-fair VRF roulette demo"]})]}),(0,r.jsx)("div",{className:"jsx-475590cc5d45b8e1 row",children:e?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:[e.toBase58().slice(0,6),"…",e.toBase58().slice(-6)]}),(0,r.jsx)("button",{onClick:v,className:"jsx-475590cc5d45b8e1 btn-secondary",children:"Disconnect"})]}):(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsx)("button",{onClick:w,className:"jsx-475590cc5d45b8e1",children:"Connect wallet"}),(0,r.jsx)("a",{href:"https://solflare.com/",target:"_blank",rel:"noreferrer",style:{fontSize:13,textDecoration:"none"},className:"jsx-475590cc5d45b8e1 muted",children:"Install Solflare"})]})})]}),(0,r.jsxs)("div",{style:{marginTop:14},className:"jsx-475590cc5d45b8e1 grid grid-2",children:[(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"RPC:"})," ",(0,r.jsx)("span",{style:{wordBreak:"break-all"},className:"jsx-475590cc5d45b8e1",children:c})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"Program:"})," ",(0,r.jsx)("span",{style:{wordBreak:"break-all"},className:"jsx-475590cc5d45b8e1",children:"ErfuhJxxpHNKviT5LCnupGhSUbXpjfRThxikEgb94aDt"})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"Wallet:"})," ",(0,r.jsx)("span",{style:{wordBreak:"break-all"},className:"jsx-475590cc5d45b8e1",children:e?e.toBase58():"Not connected"})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 kv",children:[(0,r.jsx)("strong",{className:"jsx-475590cc5d45b8e1",children:"SOL:"})," ",null!==n?n.toFixed(4):"—"]})]})]}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsx)("h2",{className:"jsx-475590cc5d45b8e1",children:"Table"}),I&&K.length>0?(0,r.jsxs)("div",{style:{marginBottom:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:6},className:"jsx-475590cc5d45b8e1",children:"Select table"}),(0,r.jsx)("select",{value:K.includes(M)?M:K[0],onChange:e=>{let t=e.target.value.trim();_(t);try{window.localStorage.setItem("selectedTablePda",t)}catch(e){}},style:{width:"100%"},className:"jsx-475590cc5d45b8e1",children:K.map(e=>(0,r.jsxs)("option",{value:e,className:"jsx-475590cc5d45b8e1",children:[e.slice(0,4),"…",e.slice(-4)]},e))}),(0,r.jsx)("div",{style:{fontSize:13,marginTop:6},className:"jsx-475590cc5d45b8e1 muted",children:"Add/remove tables via NEXT_PUBLIC_TABLE_PDAS (comma-separated) in Render."})]}):null,W?(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsxs)("label",{style:{gap:8},className:"jsx-475590cc5d45b8e1 row",children:["Table number (seed):",(0,r.jsx)("input",{type:"number",value:$,onChange:e=>ee(Number(e.target.value||0)),style:{width:160},className:"jsx-475590cc5d45b8e1"})]}),(0,r.jsx)("button",{onClick:async()=>{try{if(!e)return alert("Connect wallet first");let{program:t,provider:n}=await k(),r=Number.isFinite($)?Math.floor($):Math.floor(1e6*Math.random()),a=(await u.ZP.createTable(t,n,{seed:r,usdcMint:"9sNnTsxUPfLApmVzcoyA64VoaPhdCLynfQTM33hDfNdL",govMint:"GrSGzfP8B7fpbiE4mAAJRxW3bvvumdAXiBYb84ggt1Jk",mode:0,minBet:1e4,maxBet:1e9})).tablePda;_(a);let s=0;for(;s<10;){if(await new Promise(e=>setTimeout(e,1e3)),await m.getAccountInfo(new o.PublicKey(a))){alert("Table created successfully! Address: "+a);return}s++}alert("Table tx sent but account not yet visible. Address: "+a)}catch(e){console.error(e),alert("createTable failed: "+((null==e?void 0:e.message)||e))}},className:"jsx-475590cc5d45b8e1",children:"Create Table"})]}):(0,r.jsx)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:"Table creation is available only to functional-token owners."}),(0,r.jsxs)("div",{style:{marginTop:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("div",{style:{fontSize:13,color:"#666"},className:"jsx-475590cc5d45b8e1",children:M?"Table: configured (".concat(M.slice(0,4),"…").concat(M.slice(-4),")"):"Table: not configured (operator must set NEXT_PUBLIC_TABLE_PDA / NEXT_PUBLIC_TABLE_PDAS, or create a table)"}),D||I||!W?null:(0,r.jsxs)("div",{style:{marginTop:10},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("label",{style:{display:"block",marginBottom:6},className:"jsx-475590cc5d45b8e1",children:"Table address (PDA) (owner only)"}),(0,r.jsx)("input",{value:M,onChange:e=>_(e.target.value.trim()),placeholder:"Paste table PDA here",style:{width:"100%"},className:"jsx-475590cc5d45b8e1"})]})]}),S&&C>=51?(0,r.jsxs)("div",{style:{marginTop:16,background:"#fff3cd",borderColor:"rgba(0,0,0,0.08)"},className:"jsx-475590cc5d45b8e1 notice",children:[(0,r.jsx)("h3",{style:{margin:"0 0 8px 0",fontSize:15},className:"jsx-475590cc5d45b8e1",children:"Deposit Liquidity (Required before bets)"}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsx)("input",{type:"number",placeholder:"Amount (USDC)",id:"liquidityAmount",style:{width:150},defaultValue:10,className:"jsx-475590cc5d45b8e1"}),(0,r.jsx)("button",{onClick:async()=>{try{var t;if(!e)return alert("Connect wallet first");if(!M)return alert("Set table address first");let{program:n,provider:r}=await k(),a=Number((null===(t=document.getElementById("liquidityAmount"))||void 0===t?void 0:t.value)||0);if(!a||a<=0)return alert("Enter valid amount");let s=new o.PublicKey(M);await u.ZP.depositLiquidity(n,r,{table:s,amount:Math.round(1e6*a)}),alert("Liquidity deposited successfully!")}catch(e){console.error(e),alert("depositLiquidity failed: "+((null==e?void 0:e.message)||e))}},className:"jsx-475590cc5d45b8e1",children:"Deposit Liquidity"}),(0,r.jsx)("span",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:"Operators must fund the vault before players can bet"})]}),(0,r.jsxs)("div",{style:{marginTop:10},className:"jsx-475590cc5d45b8e1 row",children:[(0,r.jsx)("input",{type:"number",placeholder:"Withdraw (USDC)",id:"withdrawAmount",style:{width:150},defaultValue:1,className:"jsx-475590cc5d45b8e1"}),(0,r.jsx)("button",{onClick:async()=>{try{var t;if(!e)return alert("Connect wallet first");if(!M)return alert("Set table address first");let{program:n,provider:r}=await k(),a=Number((null===(t=document.getElementById("withdrawAmount"))||void 0===t?void 0:t.value)||0);if(!a||a<=0)return alert("Enter valid amount");let s=new o.PublicKey(M);await u.ZP.executeWithdraw(n,r,{table:s,amount:Math.round(1e6*a)}),alert("Liquidity withdrawn successfully!")}catch(e){console.error(e),alert("withdraw failed: "+((null==e?void 0:e.message)||e))}},className:"jsx-475590cc5d45b8e1",children:"Withdraw Liquidity"}),(0,r.jsx)("span",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1 muted",children:"Withdraw rules depend on table mode (PUBLIC has delay)"})]})]}):null]}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsx)("h2",{className:"jsx-475590cc5d45b8e1",children:"Resolve Bet (Spin Roulette)"}),(0,r.jsxs)("div",{style:{display:"flex",gap:18,alignItems:"center",flexWrap:"wrap",marginBottom:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{width:140,height:140,borderRadius:"50%",border:"10px solid #f7f7f7",position:"relative",background:eS,boxShadow:"inset 0 0 0 2px rgba(255,255,255,0.65)",transform:"rotate(".concat(ef+-360/37/2,"deg)")},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("div",{style:{position:"absolute",top:-12,left:"50%",transform:"translateX(-50%)",width:0,height:0,borderLeft:"10px solid transparent",borderRight:"10px solid transparent",borderBottom:"16px solid #333"},className:"jsx-475590cc5d45b8e1"}),("waiting"===eo||"spinning"===eo)&&(0,r.jsx)("div",{style:{position:"absolute",inset:8,borderRadius:"50%",animation:"ballOrbit 0.55s linear infinite"},className:"jsx-475590cc5d45b8e1",children:(0,r.jsx)("div",{style:{position:"absolute",top:-2,left:"50%",transform:"translateX(-50%)",width:10,height:10,borderRadius:"50%",background:"#fff",boxShadow:"0 0 0 2px rgba(0,0,0,0.15)"},className:"jsx-475590cc5d45b8e1"})}),(0,r.jsx)("div",{style:{position:"absolute",inset:18,borderRadius:"50%",background:"#fff",display:"flex",alignItems:"center",justifyContent:"center",fontWeight:800,fontSize:36,animation:"revealed"===eo?"popIn 220ms ease-out":void 0,color:null===eu?"#333":"red"===ek(eu)?"#721c24":"green"===ek(eu)?"#155724":"#111"},className:"jsx-475590cc5d45b8e1",children:null===eu?"—":eu})]}),(0,r.jsxs)("div",{style:{minWidth:320},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{fontSize:14,color:"#555",marginBottom:6},className:"jsx-475590cc5d45b8e1",children:["waiting"===eo&&"Waiting for ORAO VRF…","spinning"===eo&&"Spinning…","revealed"===eo&&"Result","idle"===eo&&"Ready"]}),ec&&(0,r.jsx)("div",{className:"jsx-475590cc5d45b8e1 "+"notice ".concat("success"===ec.kind?"notice-success":"error"===ec.kind?"notice-danger":"notice-info"),children:ec.text}),es&&(0,r.jsx)("div",{style:{marginTop:10,fontSize:15,fontWeight:700},className:"jsx-475590cc5d45b8e1",children:es.win?"WIN: +".concat(es.payout," USDC"):"LOSS"})]})]}),(0,r.jsxs)("div",{className:"jsx-475590cc5d45b8e1 notice notice-info",children:[(0,r.jsx)("p",{style:{margin:"0 0 12px 0",fontSize:14},className:"jsx-475590cc5d45b8e1",children:"Сначала делаем ставку. Затем ORAO VRF подтверждает случайность (это защищает от подкрутки). Когда будет готово — нажми SPIN."}),(0,r.jsx)("div",{style:{display:"flex",gap:8,alignItems:"center",flexWrap:"wrap"},className:"jsx-475590cc5d45b8e1",children:(0,r.jsx)("button",{disabled:!er||!M||"waiting"===eo||"spinning"===eo,onClick:async()=>{try{if(ei(null),!e){ei({kind:"error",text:"Connect wallet first"});return}if(!M){ei({kind:"error",text:"Set table address first"});return}let t=null==er?void 0:er.trim();if(!t)return ei({kind:"error",text:"Сначала сделай ставку"});let{program:n,provider:r}=await k(),a=new o.PublicKey(M),s=new o.PublicKey(t);if(ex||(ed("waiting"),em(null),ei({kind:"info",text:"Ждём подтверждение VRF…"})),!await r.connection.getAccountInfo(s)){ed("idle"),ei({kind:"error",text:"Bet account not found"});return}try{let e=await u.ZP.getBet(r,s,"confirmed");if(e.isSettled||(e=await u.ZP.getBet(r,s,"finalized")),e.isSettled&&null!==e.resultNumber){let t=e.payout>0n;ed("revealed"),em(e.resultNumber),el({number:e.resultNumber,win:t,payout:Number(e.payout)/1e6}),eT(),ei({kind:t?"success":"info",text:t?"Already resolved. Result ".concat(e.resultNumber,". Won ").concat(Number(e.payout)/1e6," USDC."):"Already resolved. Result ".concat(e.resultNumber,". Lost.")});return}}catch(e){}try{let e=(await u.ZP.getBet(r,s,"confirmed")).randomnessAccount,t=Date.now();for(;Date.now()-t<3e4&&!(await u.ZP.getOraoRandomnessV2Fulfilled(r,e,"confirmed")).fulfilled;)await new Promise(e=>setTimeout(e,1500));if(!(await u.ZP.getOraoRandomnessV2Fulfilled(r,e,"confirmed")).fulfilled){ed("waiting"),ei({kind:"info",text:"Randomness not fulfilled yet. Wait 5–15s and try again."});return}}catch(e){console.warn("Randomness poll warning:",e)}ed("spinning"),ei({kind:"info",text:"Spinning…"});let l=await u.ZP.resolveBet(n,r,{table:a,bet:s,player:e});try{await r.connection.confirmTransaction(l,"confirmed")}catch(e){console.warn("confirmTransaction warning:",e)}await new Promise(e=>setTimeout(e,1500));try{let e=await u.ZP.getBet(r,s,"confirmed");if(e.isSettled||(e=await u.ZP.getBet(r,s,"finalized")),e.isSettled&&null!==e.resultNumber){let t=e.payout>0n;ed("revealed"),em(e.resultNumber),el({number:e.resultNumber,win:t,payout:Number(e.payout)/1e6}),eT(),ei({kind:t?"success":"info",text:t?"Result ".concat(e.resultNumber,". Won ").concat(Number(e.payout)/1e6," USDC."):"Result ".concat(e.resultNumber,". Lost.")})}else try{let e=await r.connection.getTransaction(l,{commitment:"confirmed",maxSupportedTransactionVersion:0});e&&e.meta&&e.meta.err?(ed("idle"),ei({kind:"error",text:"Resolve transaction failed. Check console for logs."}),console.error("Transaction error:",e.meta.err)):e?(ed("idle"),ei({kind:"info",text:"Tx succeeded but account not updated yet (RPC lag). Try again in a few seconds."})):(ed("idle"),ei({kind:"info",text:"Transaction not found yet (congestion). Wait a bit and retry."}))}catch(e){console.error("Error fetching transaction:",e),ed("idle"),ei({kind:"error",text:"Could not fetch transaction details."})}}catch(e){console.error("Error fetching bet result:",e),ed("idle"),ei({kind:"error",text:"Resolved, but failed to fetch result (RPC lag). Try again."})}}catch(e){console.error(e),ed("idle"),ei({kind:"error",text:"resolveBet failed: "+((null==e?void 0:e.message)||e)})}},className:"jsx-475590cc5d45b8e1",children:ex?"SPIN":er?"WAIT…":"SPIN"})}),(0,r.jsxs)("div",{style:{marginTop:8,fontSize:13,color:"#0c5460"},className:"jsx-475590cc5d45b8e1",children:[!er&&"Шаг 1: сделай ставку. После этого появится ожидание VRF.",er&&!ex&&"Шаг 2: идёт проверяемая генерация случайности (VRF). Это нужно для честной рулетки.",er&&ex&&"Шаг 3: нажми SPIN, чтобы открыть результат и выплату."]})]})]}),(0,r.jsxs)("section",{className:"jsx-475590cc5d45b8e1 card",children:[(0,r.jsx)("h2",{className:"jsx-475590cc5d45b8e1",children:"Place a bet"}),es&&(0,r.jsxs)("div",{style:{marginBottom:20},className:"jsx-475590cc5d45b8e1 "+"notice ".concat(es.win?"notice-success":"notice-danger"),children:[(0,r.jsxs)("h3",{style:{margin:0},className:"jsx-475590cc5d45b8e1",children:["Last Spin Result: ",es.number]}),(0,r.jsx)("p",{style:{margin:"5px 0 0"},className:"jsx-475590cc5d45b8e1",children:es.win?"YOU WON! Payout: ".concat(es.payout," USDC"):"You lost."})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:24,alignItems:"flex-start",flexWrap:"wrap"},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("div",{style:{flex:"1 1 1024px",maxWidth:"100%",overflowX:"auto"},className:"jsx-475590cc5d45b8e1",children:(0,r.jsx)(p,{mode:J,selected:O,selectedPair:V,selectedCorner:q,selectedStreet:X,placedBets:et,currentBetType:J,currentStake:Y,onPlace:e=>{en(t=>[...t,e])},onRemove:e=>{en(t=>t.filter((t,n)=>n!==e))},onSelect:e=>{H("straight"),U(e),F(null),Z(null),G(null)},onSelectPair:(e,t)=>{F([e,t]),Z(null),U(null),G(null),H("split")},onSelectCorner:e=>{Z(e),F(null),U(null),G(null),H("corner")},onSelectStreet:e=>{G(e),F(null),Z(null),U(null),H("street")},onSelectDozen:e=>{H("dozen"),U(e),F(null),Z(null),G(null)},onSelectColumn:e=>{H("column"),U(e),F(null),Z(null),G(null)},onSelectOutside:e=>{H(e),U(null),F(null),Z(null),G(null)}})}),(0,r.jsxs)("div",{style:{flex:"1 1 280px",minWidth:260},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{marginBottom:8},className:"jsx-475590cc5d45b8e1",children:["Selected: ",eA]}),(0,r.jsxs)("div",{style:{marginBottom:8},className:"jsx-475590cc5d45b8e1",children:["Stake (USDC): ",(0,r.jsx)("input",{type:"number",value:Y,min:1,onChange:e=>Q(Number(e.target.value||1)),style:{width:120},className:"jsx-475590cc5d45b8e1"})]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("button",{onClick:eB,className:"jsx-475590cc5d45b8e1",children:"Place Bet"}),(0,r.jsx)("button",{onClick:function(){if(ei(null),"straight"===J&&null===O)return ei({kind:"error",text:"Select a number"});if("split"===J&&(!V||V[0]===V[1]))return ei({kind:"error",text:"Select a valid split"});if("corner"===J&&(!q||4!==q.length))return ei({kind:"error",text:"Select a valid corner (4 numbers)"});if("street"===J&&(!X||3!==X.length))return ei({kind:"error",text:"Select a valid street (3 numbers)"});let e=null;e="split"===J?V:"corner"===J?q:"street"===J?X:O;let t={type:J,value:e,stake:Y};en(e=>[...e,t]),U(null),F(null),Q(1)},className:"jsx-475590cc5d45b8e1 btn-secondary",children:"Add Chip"}),(0,r.jsx)("button",{onClick:()=>{U(null),Q(1)},className:"jsx-475590cc5d45b8e1 btn-danger",children:"Clear"})]}),(0,r.jsxs)("div",{style:{marginTop:12},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("h3",{style:{margin:"8px 0"},className:"jsx-475590cc5d45b8e1",children:["Bet Slip (",et.length,")"]}),(0,r.jsxs)("div",{style:{display:"flex",flexDirection:"column",gap:8},className:"jsx-475590cc5d45b8e1",children:[et.map((e,t)=>(0,r.jsxs)("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",background:"#f7f7f7",padding:8,borderRadius:6},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsxs)("div",{style:{fontSize:13},className:"jsx-475590cc5d45b8e1",children:[e.type," ",Array.isArray(e.value)?JSON.stringify(e.value):String(e.value)]}),(0,r.jsxs)("div",{style:{display:"flex",gap:8,alignItems:"center"},className:"jsx-475590cc5d45b8e1",children:[(0,r.jsx)("input",{type:"number",value:e.stake||Y,min:1,onChange:e=>{let n=Number(e.target.value||1);en(e=>e.map((e,r)=>r===t?{...e,stake:n}:e))},style:{width:80},className:"jsx-475590cc5d45b8e1"}),(0,r.jsx)("button",{onClick:()=>en(e=>e.filter((e,n)=>n!==t)),className:"jsx-475590cc5d45b8e1 btn-secondary",children:"Remove"})]})]},t)),0===et.length&&(0,r.jsx)("div",{className:"jsx-475590cc5d45b8e1 muted",children:"No chips placed"})]})]})]})]})]}),(0,r.jsx)(x.Z,{})]})]})}}},function(e){e.O(0,[766,861,655,961,139,756,288,888,774,179],function(){return e(e.s=8312)}),_N_E=e.O()}]);